<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Questions</title>
  <link rel="stylesheet" href="manage.css">

</head>
<body>
<div class="container">
  <div class="header-container">
    <h2>Manage Questions</h2>
    <div class="home-button-container">
      <button class="homeBtn" onclick="window.location.href='index.html'">üè† Home</button>
    </div>
  </div>
  <table id="questionsTable">
    <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Option 1</th>
      <th>Option 2</th>
      <th>Option 3</th>
      <th>Option 4</th>
      <th>Category</th>
      <th>Difficulty</th>
      <th>Answer</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


<script>
  //Alert for User
  alert("Warning: Admins-Only Page. This page will not work for users");
  const token = localStorage.getItem('jwtToken');

  async function loadQuestions() {
    try {
      const res = await fetch('/question/allQuestions', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      if (!res.ok) {
        console.error('Server error:', res.status);
        alert('Failed to load questions.');
        return;
      }
      const questions = await res.json();
      displayQuestions(questions);
    } catch (err) {
      console.error('Fetch failed:', err);
      alert('Could not connect to server.');
    }
  }

  function displayQuestions(questions) {
    const tbody = document.querySelector('#questionsTable tbody');
    tbody.innerHTML = '';
    if (!questions.length) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td colspan="10" style="text-align:center;">No questions found.</td>`;
      tbody.appendChild(tr);
      return;
    }
    questions.forEach(q => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${q.id ?? ''}</td>
        <td><input type="text" id="title-${q.id}" value="${q.questionTitle ?? ''}"></td>
        <td><input type="text" id="option1-${q.id}" value="${q.option1 ?? ''}"></td>
        <td><input type="text" id="option2-${q.id}" value="${q.option2 ?? ''}"></td>
        <td><input type="text" id="option3-${q.id}" value="${q.option3 ?? ''}"></td>
        <td><input type="text" id="option4-${q.id}" value="${q.option4 ?? ''}"></td>
        <td><input type="text" id="category-${q.id}" value="${q.category ?? ''}"></td>
        <td><input type="text" id="difficulty-${q.id}" value="${q.difficultyLevel ?? ''}"></td>
        <td><input type="text" id="answer-${q.id}" value="${q.rightAnswer ?? ''}"></td>
        <td class="actions">
          <button class="updateBtn" onclick="updateQuestion(${q.id})">Update</button>
          <button class="deleteBtn" onclick="deleteQuestion(${q.id})">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
    });
  }

  async function updateQuestion(id) {
    const data = {
      id: id,
      questionTitle: document.getElementById(`title-${id}`).value,
      option1: document.getElementById(`option1-${id}`).value,
      option2: document.getElementById(`option2-${id}`).value,
      option3: document.getElementById(`option3-${id}`).value,
      option4: document.getElementById(`option4-${id}`).value,
      category: document.getElementById(`category-${id}`).value,
      difficultyLevel: document.getElementById(`difficulty-${id}`).value,
      rightAnswer: document.getElementById(`answer-${id}`).value,
    };
    try {
      const res = await fetch(`/question/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(data)
      });
      if (res.ok) {
        alert('Question updated successfully');
      } else {
        alert('Failed to update question');
      }
    } catch (err) {
      console.error('Update error:', err);
    }
  }

  async function deleteQuestion(id) {
    if (!confirm('Are you sure you want to delete this question?')) return;
    try {
      const res = await fetch(`/question/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      if (res.ok) {
        alert('Question deleted');
        loadQuestions();
      } else {
        alert('Failed to delete question');
      }
    } catch (err) {
      console.error('Delete error:', err);
    }
  }

  loadQuestions();
</script>
</body>
</html>