<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login - Quiz App</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h2>Log In</h2>
  <form id="loginForm">
    <input type="text" id="username" placeholder="Username" required><br>

    <input type="password" id="password" placeholder="Password" required><br>

    <button type="submit">Log In</button>
  </form>
  <div id="message" style="text-align: center; margin-top: 15px;"></div>
  <p style="text-align: center; margin-top: 20px;">
    Don't have an account? <a href="signup.html">Sign Up</a>
  </p>
</div>

<script>
  const loginForm = document.getElementById('loginForm');
  const messageDiv = document.getElementById('message');

  loginForm.addEventListener('submit', async (event) => {
      event.preventDefault();

      // These lines will now work correctly
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      const userData = {
          username: username,
          password: password
      };

      try {
          const response = await fetch('/auth/login', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify(userData)
          });

          if (response.ok) {
              const token = await response.text();
              localStorage.setItem('jwtToken', token);

              messageDiv.style.color = 'green';
              messageDiv.textContent = 'Login successful! Redirecting...';

              setTimeout(() => {
                  window.location.href = 'index.html';
              }, 1500);

          } else {
              messageDiv.style.color = 'red';
              messageDiv.textContent = 'Login failed: Invalid username or password.';
          }
      } catch (error) {
          console.error('Error:', error);
          messageDiv.style.color = 'red';
          messageDiv.textContent = "An error occurred. Could not connect to the server.";
      }
  });
</script>
</body>
</html>